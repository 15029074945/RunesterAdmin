<?php//输出安全的htmlfunction valiSafechar($text){$text = trim($text);$text = htmlspecialchars($text);return $text;}//替换到Url中的 http:// 前缀function replaceUrlhttp($str){    $str = str_replace("http://","",$str);    return $str;}//留言回复用删除p标签解决换行问题function BookReplyText($str){    $str = str_replace("<p>","",$str);    $str = str_replace("</p>","<br />",$str);//  $str = str_replace(" ","",$str);//  $str = str_replace("  ","",$str);    $str = substr($str,   0,   strlen($str)   -   strlen( " <br/> "));    return $str;}//nl2br逆函数function br2nl($str){    $str = str_replace("<br />","",$str);    $str = trim($str);    return $str;}//移除换行符function replace_nr($char){	$char = trim($char);	$char=str_replace("\n","",$char);	$char=str_replace("\r","",$char);	$char=str_replace("\r\n","",$char);	return $char;}//检查日期是否符合0000-00-00  function isDate($sDate){  if( ereg("^[0-9]{4}\-[][0-9]{2}\-[0-9]{2}$",$sDate) ) return true;  else return false;  }// 生成一个随机数function getrate($length = 8) {   // $chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()-_ []{}<>~`+=,.;:/?|';    $chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';    $password = '';    for ( $i = 0; $i < $length; $i++ )     {        $password .= $chars[ mt_rand(0, strlen($chars) - 1) ];    }    return $password;}function FrontHash($hash){    for($i=7;$i>0;$i--) {        $hash=base64_encode($hash);        $hash=md5($hash);        $hash=sha1($hash);        $hash=hash("sha256", $hash);        $hash=hash("sha512", $hash);    }    return $hash;}//获取当前时间function currentTime(){	return date("Y-m-d H:i:s");}//获取时间戳function unixtime($date = ""){	if($date == "")	$date = date("Y-m-d H:i:s");	$strtotime =  strtotime($date);	return $strtotime;}//时间戳转换为日期function forDate($strtotime,$dateType=1,$timeType=1){    if($strtotime != ""){    	switch($dateType){    		case 1 :$date = date( "Y-m-d",$strtotime);break;    		case 2 :$date = date( "m-d",$strtotime);break;    		default : $date = "";break;    	}	  	switch($timeType){			case 1 : $time = date(" H:i",$strtotime);break;			case 2 : $time = date(" H:i:s",$strtotime);break;			default : $time = "";break;    	}		return $date.$time;    }    else return false;}function strip_char($char){    $strip = strip_tags($char);    $strip = trim($strip);    return $strip;}/** *  * 获取客户端真实IP地址 * */function getIP(){ if (getenv("HTTP_CLIENT_IP") && strcasecmp(getenv("HTTP_CLIENT_IP"), "unknown")) $ip = getenv("HTTP_CLIENT_IP"); else if (getenv("HTTP_X_FORWARDED_FOR") && strcasecmp(getenv("HTTP_X_FORWARDED_FOR"), "unknown")) $ip = getenv("HTTP_X_FORWARDED_FOR"); else if (getenv("REMOTE_ADDR") && strcasecmp(getenv("REMOTE_ADDR"), "unknown")) $ip = getenv("REMOTE_ADDR"); else if (isset($_SERVER['REMOTE_ADDR']) && $_SERVER['REMOTE_ADDR'] && strcasecmp($_SERVER['REMOTE_ADDR'], "unknown")) $ip = $_SERVER['REMOTE_ADDR']; else $ip = "unknown"; return($ip); } /** * 对text字段的文本进行压缩，降低字段长度。 * * @author frontLon * @example contentCompress($需要压缩的文本变量) *  * @param  text $content      [需要压缩的内容] * @return text * * @todo 由于写入数据库问题，加入了base64编码，影响速度。 */function contentCompress($content){	if($content != ""){	$content = gzcompress($content);	$content= base64_encode($content);	return $content;	}	else return false;}/** * 对contentCompress处理过的text进行解压 * * @name   contentUnCompress * @author frontLon * @example contentUnCompress($压缩后的文本变量) *  * @param  text $content      [需要解压的内容] * @return text * * @todo 由于写入数据库问题，加入了base64编码，影响速度。 */ function contentUnCompress($content){	if($content != ""){	$content = base64_decode($content);	$content= gzuncompress($content);	return $content;	}	else return false;}/** * 获取父级或以上ID * 下标从1开始。以此往上 * * @author frontLon * @example $par = getParent($vo['CategoryRid']); echo $par[1]; *  * @param  array $char      [传入path数组] * @return array * */ function getParent($char){$array = explode("-",$char);  //分隔数组array_unshift($array,""); //为数组的下标0添加一个空值，使下标从1开始，方便记忆。return $array;}/** * 检验$array中是否存在$char * * @author frontLon * @example if(checkParent($vo['CatePath'],5)) return true; else return false; *  * @param  integer $array	[传入path数组] * @param  integer $char	[是否存在的值] * @return bool * */function checkParent($array,$char){$array = explode("-",$array);if(in_array($char,$array))    return true;else    return false;}/** * Path字段追加所有父ID * * @author frontLon * @example $par = addParent($_POST['category']);echo $par; * @param  integer $id      [传入的父ID] * @param  integer $type      [0:分类取值；1:文章取值] * @return void *  */function addParent($pid=0,$type=1){	if($pid != 0){		$Model = M("Category");		$vo = $Model ->where("id = $pid")->field("path")->find();		if($vo['path'] == "0" or $vo['path'] == "") $par = "-" . $pid . "-";		else{		//	if($type == 1) $par = $vo['path']; //新闻或页面path不追加id		//	else $par = "-".$pid.$vo['path']; //分类追加id			$par = "-".$pid.$vo['path']; //分类追加id		}  		return $par;	}}/*	二维数组去重*/function unique_arr($array2D,$stkeep=false,$ndformat=true){	if($stkeep) $stArr = array_keys($array2D); //一级数组键可以为非数字	if($ndformat) $ndArr = array_keys(end($array2D)); //二级数组键必须相同	foreach ($array2D as $v){  //降维		$v = join(",",$v);		$temp[] = $v;	}	$temp = array_unique($temp);	foreach ($temp as $k => $v){  //数组重新组合		if($stkeep){$k = $stArr[$k];}		if($ndformat){			$tempArr = explode(",",$v);			foreach($tempArr as $ndkey => $ndval){			$output[$k][$ndArr[$ndkey]] = $ndval;		}		}else{$output[$k] = explode(",",$v);}	}	return $output;}/** * 判断是否存在权限 * * @author frontLon * @example <if condition="returnAuth('Adminx/Page/index')">...</if> * @param  char $rule      [传入规则] * @return void *  */function returnAuth($rule){/*	$notAuth_user = in_array(session("admin_username"), explode(",", C("AUTH_CONFIG.NOT_AUTH_USER")));	if(!$notAuth_user) {		$Auth = new \Think\Auth();		if($Auth->check($rule, session('admin_id'))) return true;		else return false;	}	else{return true;}	*/	return true;}//将网站配置写入配置文件function write_file($setfile="",$arrName="",$content=""){	//开始定义文件内容	$settingstr="<?php \n return array(\n'$arrName' =>array(\n";	foreach($content as $key=>$v){		$key = strtoupper($key); //数组名转为大写		$v = htmlspecialchars_decode($v); //关闭HTML标签过滤		$v = replace_nr($v); //移除换行符		$settingstr.= "\t'".$key."'=>'".$v."',\n";	}	$settingstr.="),\n);\n?>\n";	file_put_contents($setfile,$settingstr); //写入文件}/*	将电话每三位进行分隔*/function partitionsNum($str){$patten = '/(?=(?:\d\d\d\d)+(?!\d))(?<=\d)/';  echo preg_replace($patten,'-',$str);  }?>