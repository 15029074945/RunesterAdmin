<?php//列表用功能小按钮function btn($type,$key,$func = "",$controller=CONTROLLER_NAME){	$v = $GLOBALS['vo'][$key];	//编辑	if($type == "edit"){		$url = U($controller."/edit","id=".$v['id']);		$button = "<a href='". $url ."' class='listBtn lbtnEdit' title='编辑'></a>";	}	//置顶	elseif($type == "top"){		switch($v['isTop']){			case 0:				$v['btn_style'] = "Top";				$v['btn_title'] = "未置顶，点击置顶";				break;			case 1:				$v['btn_style'] = "Down";				$v['btn_title'] = "已置顶，点击取消";				break;		}		$url = U("$controller/top","&state={$v['isTop']}&id={$v['id']}");		$button = "<a href='". $url ."' class='listBtn lbtn{$v['btn_style']}' title='{$v['btn_title']}' ></a>";	}	//禁用	elseif($type == "status"){		switch($v['status']){			case 1:				$v['btn_style'] = "Disable";				$v['btn_title'] = "未禁用，点击禁用";				break;			case 0:				$v['btn_style'] = "Enable";				$v['btn_title'] = "已禁用，点击禁用";				break;		}		$url = U("$controller/status","&state={$v['status']}&id={$v['id']}");		$button = "<a href='". $url ."' class='listBtn lbtn{$v['btn_style']}' title='{$v['btn_title']}' ></a>";	}	//隐藏显示	elseif($type == "hide"){		switch($v['isHide']){		case 0:			$v['btn_style'] = "Show";			$v['btn_title'] = "显示中，点击隐藏";			break;		case 1:			$v['btn_style'] = "Hide";			$v['btn_title'] = "已隐藏，点击显示";			break;		}		$url = U("$controller/show","state={$v['isHide']}&id={$v['id']}");		$button = "<a href='". $url ."' class='listBtn lbtn{$v['btn_style']}' title='{$v['btn_title']}'></a>";	}	//保护状态	elseif($type == "protect"){		switch($v['isProtect']){	    	case 0:					$v['btn_style'] = "NoProtect";					$v['btn_title'] = "未保护，点击保护";					break;			case 1:					$v['btn_style'] = "Protect";					$v['btn_title'] = "保护中，点击取消";					break;    	}		$url = U("$controller/protect","&state={$v['isProtect']}&id={$v['id']}");		$button = "<a href='". $url ."' class='listBtn lbtn{$v['btn_style']}' title='{$v['btn_title']}'></a>";	}		//移动到回收站	elseif($type == "recycle"){		switch($v['isProtect']){    		case 0:				$v['btn_url'] = U("$controller/recycle","&state=" . $v['isDel'] . "&id=" . $v['id']);			    $v['btn_func'] = "isConfirm(\"{$v['btn_url']}\",\"确定要删除吗？\")";				$v['btn_title'] = "删除";				$v['btn_style'] = "Recycle";				break;			case 1:				$v['btn_title'] = "此记录被保护，如被网站前端使用，删除可能会导致前台错误。请谨慎操作。";				$v['btn_style'] = "RecycleDisable";				break;				    	}    	$button = "<a href='javascript:void(0)' class='listBtn lbtn{$v['btn_style']}' title='{$v['btn_title']}' onclick = '{$v['btn_func']}' ></a>";	}	//从回收站还原	elseif($type == "restore"){		$v['btn_url'] = U("$controller/recycle","&state=" . $v['isDel'] . "&id=" . $v['id']);	    $v['btn_func'] = "isConfirm(\"{$v['btn_url']}\",\"确定要还原吗？\")";		$v['btn_title'] = "还原";		$v['btn_style'] = "Restore";		$button = "<a href='javascript:void(0)' class='listBtn lbtn{$v['btn_style']}' title='{$v['btn_title']}' onclick='{$v['btn_func']}' ></a>";	}	//彻底删除	elseif($type == "delete"){		$url = U($controller . "/delete","id=" . $v['id']);		$v['btn_func'] = "isConfirm(\"$url\",\"确定要删除吗？\")";		$v['btn_style'] = "Delete";		$v['btn_title'] = "删除";					$button = "<a href='javascript:void(0)' class='listBtn lbtn{$v['btn_style']}' title='{$v['btn_title']}' onclick = '{$v['btn_func']}' ></a>";	}	//访问预览	elseif($type == "enter"){		$v['btn_url'] = "#";		$v['btn_title'] = "点击访问";					$button = "<a href='{$v['btn_url']}' class='listBtn lbtnEnter' title='{$v['btn_title']}' ></a>";	}	//授权	if($type == "auth"){		$url = U($controller."/access","id=".$v['id']);		$button = "<a href='". $url ."' class='listBtn lbtnAuth' title='授权'></a>";	}	//留言回复	if($type == "reply"){		$url = U($controller."/reply","id=".$v['id']);		$button = "<a href='javascript:void(0)' onclick='popwindow_reply(\"$url\",\"{$v['username']}\")' class='listBtn lbtnReply' title='回复'></a>";	}	echo $button;	    }//获取列表中状态标题function getStateTitle($var,$type){		switch($type){		case "hide" :			$var = ($var == 0 ) ? "显示" : "隐藏";			break;		case "top" :			$var = ($var == 0 ) ? "未置顶" : "已置顶";			break;		case "protect" :			$var = ($var == 0 ) ? "未保护" : "保护";			break;		case "status" :			$var = ($var == 0 ) ? "不启用" : "启用";			break;	}	return $var;}function getImgFileInfo($file){	$fileExt =  pathinfo($file, PATHINFO_EXTENSION); //获取文件扩展名	$url = "/public/image/$file"; //	$url2=iconv("utf-8","gb2312",$url);	$filesize = ceil(filesize($url)/1000)."k";	$imgsize=getimagesize($url);	echo "文件类型：$fileExt<br />";//	echo "尺寸：".$imgsize[0] . "X" . $imgsize[1];}/**	导航列表表格*/function getNavTable($pid=0,$cate,$loop=0){	$Model = M("Nav");	$loop++;	$where['pid'] = intval($pid);	$where['cate'] = intval($cate);	$order = "sort ASC,id ASC";	$vo = $Model->where($where)->order($order)->select();	if($vo){		for($k=0;$k<$loop-1;$k++) $place .="&#12288;|&#12288;";		if($loop == 1) $color = "color:#555;font-weight:bold;";		else $color = "";		foreach($vo as $i => $vo){			echo "			<tr>			<td class='listTableCheckTd'>			<input type='checkbox' value='{$vo['id']}' name='artical_ID[]' id='artical_ID' />			<input type='hidden' value='{$vo['id']}' name='iId[]' id='iId' />			<input type='hidden' value='{$vo['isProtect']}' name='protect_ID[]' id='protect_ID' />			<input type='hidden' value='{$vo['pid']}' name='iPid[]' />			</td>			<td class='navTitleTd' style='$color'>			$place {$vo['title']}</td>			<td>";			getCategoryTypeName($vo['type']); //获取菜单类型			echo "</td>";					echo "			<td><input type='text' class='input SortInput' value='{$vo['sort']}' onclick='this.select();' name='iSort[]' id='iSort' title='调整完成后按回车键也可排序 :)' /></td>			<td>".getStateTitle($vo['isHide'],"hide");			$hide = getCateHideBtn("hide",$vo['isHide']);			$delurl = U(CONTROLLER_NAME . "/delete?id={$vo['id']}&type={$vo['type']}");			$delLink = "isConfirm(\"$delurl\",\"删除后不可恢复，确定要继续吗？\")";			echo"</td>			<td class='funTd'>			<a href='". U(CONTROLLER_NAME."/edit","id={$vo['id']}") ."' class='listBtn lbtnEdit' title='编辑'></a>			<a href='". U(CONTROLLER_NAME."/show","state={$vo['isHide']}&id={$vo['id']}") ."' class='listBtn lbtn{$hide['btn_style']}' title='{$hide['btn_title']}' ></a>			<a href='javascript:void(0)' class='listBtn lbtnDelete' onclick='$delLink' title='彻底删除'></a>			</td>			</tr>";						//筛选条件不为根分类时循环子分类			if(I("get.root") != 1) getNavTable($vo['id'],$cate,$loop);		}	}}/**	文章分类列表表格*/function getArticleCteTable($pid=0,$loop=0){	$Model = M("Category");	$loop++;	$where['cate_pid'] = array("eq",$pid);	$where['cate_type'] = "Article";	$order = "cate_sort ASC,cate_id ASC";	$vo = $Model->where($where)->order($order)->join($join)->field($field)->select();		if($vo){		for($k=0;$k<$loop-1;$k++) $place .="&#12288;|&#12288;";		if($loop == 1) $color = "color:#555;font-weight:bold;";		else $color = "";		foreach($vo as $i => $vo){			echo "			<tr>			<td class='navTitleTd' style='$color'>			<input type='hidden' value='{$vo['cate_id']}' name='iId[]' id='iId' />			<input type='hidden' value='{$vo['cate_pid']}' name='iPid[]' id='iPid' />			$place {$vo['cate_title']}</td>			<td><input type='text' class='input SortInput' value='{$vo['cate_sort']}' onclick='this.select();' name='iSort[]' id='iSort' title='调整完成后按回车键也可排序 :)' /></td>			";			$delurl = U(CONTROLLER_NAME . "/delete?id={$vo['id']}&type={$vo['type']}");			$delLink = "isConfirm(\"$delurl\",\"删除后不可恢复，确定要继续吗？\")";			echo"			<td class='funTd'>			<a href='". U(CONTROLLER_NAME."/edit","id={$vo['id']}") ."' class='listBtn lbtnEdit' title='编辑'></a>			<a href='javascript:void(0)' class='listBtn lbtnDelete' onclick='$delLink' title='彻底删除'></a>			</td>			</tr>";						//筛选条件不为根分类时循环子分类			if(I("get.root") != 1) getArticleCteTable($vo['cate_id'],$loop);		}	}}/**	获取列表批量功能下拉菜单功能*/function getListBatchBtn($tag=""){	$arr = explode(",",$tag);	//排序操作	if(in_array("sort",$arr)){		$url = U(CONTROLLER_NAME."/sort");		echo "<li><a href='javascript:void(0)' onclick='formSubmit(\"$url\")'>排序</a></li>";	} 	//删除操作	if(in_array("recycle",$arr)){		$url = U(CONTROLLER_NAME."/recycle?state=0");		$text = "确定要删除选定的内容吗？";		echo "<li><a href='javascript:void(0)' onclick='formConfirm(\"$url\",\"$text\")'>删除</a></li>";	}	//还原操作 	if(in_array("restore",$arr)){		$url = U(CONTROLLER_NAME."/recycle?state=1");		$text = "确定要还原选定的内容吗？";		echo "<li><a href='javascript:void(0)' onclick='formConfirm(\"$url\",\"$text\")'>还原</a></li>";	}	//置顶操作	if(in_array("top",$arr)){		$url1 = U(CONTROLLER_NAME."/top?state=0");		echo "<li><a href='javascript:void(0)' onclick='formSubmit(\"$url1\")'>置顶</a></li>";		$url2 = U(CONTROLLER_NAME."/top?state=1");		echo "<li><a href='javascript:void(0)' onclick='formSubmit(\"$url2\")'>—取消置顶</a></li>";	}	//保护操作	if(in_array("protect",$arr)){		$url1 = U(CONTROLLER_NAME."/protect?state=0");		echo "<li><a href='javascript:void(0)' onclick='formSubmit(\"$url1\")'>保护</a></li>";		$url2 = U(CONTROLLER_NAME."/protect?state=1");		echo "<li><a href='javascript:void(0)' onclick='formSubmit(\"$url2\")'>—取消保护</a></li>";	}	//状态操作	if(in_array("status",$arr)){		$url1 = U(CONTROLLER_NAME."/status?state=1");		echo "<li><a href='javascript:void(0)' onclick='formSubmit(\"$url1\")'>禁用</a></li>";		$url2 = U(CONTROLLER_NAME."/status?state=0");		echo "<li><a href='javascript:void(0)' onclick='formSubmit(\"$url2\")'>—启用</a></li>";	}	//隐藏操作	if(in_array("hide",$arr)){		$url1 = U(CONTROLLER_NAME."/show?state=0");		echo "<li><a href='javascript:void(0)' onclick='formSubmit(\"$url1\")'>隐藏</a></li>";		$url2 = U(CONTROLLER_NAME."/show?state=1");		echo "<li><a href='javascript:void(0)' onclick='formSubmit(\"$url2\")'>—显示</a></li>";	}	//彻底删除操作 	if(in_array("delete",$arr)){		$url = U(CONTROLLER_NAME."/delete");		$text = "删除后不可恢复，确定要删除选定的内容吗？";		echo "<li><a href='javascript:void(0)' onclick='formConfirm(\"$url\",\"$text\")'>彻底删除</a></li>";	}	//清空回收站操作 	if(in_array("empty",$arr)){		$url = U(CONTROLLER_NAME."/recycle_empty");		echo "<li><a href='javascript:void(0)' onclick='formConfirm(\"$url\",\"$text\")'>清空回收站</a></li>";	}}?>